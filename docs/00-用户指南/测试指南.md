# 测试指南

本文档提供完整的系统测试步骤。

## 📋 前提条件

确保已安装所有依赖：

```bash
pip install -r requirements.txt
```

核心依赖：
- Click（CLI框架）
- Rich（终端美化）
- SQLAlchemy（数据库）
- PyYAML（配置文件）

## 🎯 测试方式一：使用CLI工具（推荐）

CLI工具提供了最完整和用户友好的测试界面。

### 步骤1：查看可用框架

```bash
python stock_analyzer.py list-frameworks
```

**预期输出：**
```
评分型框架（Scoring）:
  • value_investing - 价值投资框架（巴菲特风格）
  • growth_investing - 成长投资框架（彼得·林奇风格）

筛选型框架（Screening）:
  • quality_stock_screener - 优质白马股筛选框架
```

### 步骤2：查看股票信息

```bash
python stock_analyzer.py info 600519
```

**预期输出：**
- 股票基本信息（代码、名称、市场、交易所、行业）
- 财务数据记录数
- 最新数据日期

### 步骤3：筛选股票（Pass/Fail）

**详细模式：**
```bash
python stock_analyzer.py screen 600519
```

**简化模式：**
```bash
python stock_analyzer.py screen 600519 --no-detail
```

**预期输出：**
- 筛选结果（PASS/FAIL）
- 通过率百分比
- 各类别详细检查结果（详细模式）
- 未通过条件列表（详细模式）
- 改进建议（详细模式）

### 步骤4：分析股票（0-100评分）

**详细模式：**
```bash
python stock_analyzer.py analyze 600519
```

**简化模式：**
```bash
python stock_analyzer.py analyze 600519 --no-detail
```

**预期输出：**
- 总分（0-100）
- 评级（优秀/良好/中等/及格/不及格）
- 各维度得分表格（详细模式）
- 投资建议（详细模式）

### 步骤5：批量测试多只股票

```bash
python stock_analyzer.py screen 600519,000858,AAPL --no-detail
python stock_analyzer.py analyze 600519,000858 --no-detail
```

### 步骤6：切换分析框架

```bash
# 使用价值投资框架
python stock_analyzer.py analyze 600519 -f value_investing

# 使用成长投资框架
python stock_analyzer.py analyze 600519 -f growth_investing

# 使用优质股筛选框架
python stock_analyzer.py screen 600519 -f quality_stock_screener
```

## 🧪 测试方式二：使用演示程序

### 端到端筛选测试

运行完整的筛选流程演示：

```bash
python test_end_to_end_screening.py
```

**功能：**
- 自动初始化数据库
- 尝试从数据库读取股票数据
- 如果无数据，使用模拟数据演示
- 执行筛选并显示详细结果

### 市场数据演示

演示市场数据采集功能：

```bash
python demo_market_data.py
```

**功能：**
- 初始化数据库和模拟数据源
- 演示历史市值数据获取
- 演示分红数据获取
- 显示PE计算结果

### 筛选框架演示

演示筛选框架的使用：

```bash
python demo_screener.py
```

**功能：**
- 加载筛选框架配置
- 使用模拟数据执行筛选
- 显示详细的筛选报告

### 分析框架演示

演示评分分析功能：

```bash
python demo_analyze.py
```

**功能：**
- 加载分析框架配置
- 对模拟股票进行评分
- 生成投资建议

## 📊 测试数据说明

### 当前数据库状态

运行测试后，数据库中会包含以下测试数据：

- **600519（贵州茅台）**：A股白酒行业
- 5年历史财务数据
- 包含营收、净利润、ROE、毛利率等指标

### 数据来源

1. **模拟数据**：测试程序内置的Mock数据源
   - 优点：无需网络，快速测试
   - 适用：功能验证、演示

2. **真实数据**（可选）：AkShare数据源
   - 需要安装：`pip install akshare`
   - 获取真实A股市场数据
   - 适用：生产环境

## ✅ 测试检查清单

完成以下测试项以验证系统功能：

- [ ] CLI工具所有命令能正常运行
  - [ ] `list-frameworks`
  - [ ] `info <股票代码>`
  - [ ] `screen <股票代码>`
  - [ ] `analyze <股票代码>`
  - [ ] `update-data <股票代码>` (可选，需要AkShare)

- [ ] 详细模式和简化模式都能工作
  - [ ] 默认详细输出
  - [ ] `--no-detail` 简化输出

- [ ] 框架切换功能正常
  - [ ] `-f value_investing`
  - [ ] `-f growth_investing`
  - [ ] `-f quality_stock_screener`

- [ ] 批量操作能处理多只股票
  - [ ] 逗号分隔的股票代码列表

- [ ] 演示程序能正常运行
  - [ ] `test_end_to_end_screening.py`
  - [ ] `demo_market_data.py`
  - [ ] `demo_screener.py`
  - [ ] `demo_analyze.py`

## 🐛 常见问题

### Q: 数据库在哪里？

A: 数据库文件位于 `data/database.db`（SQLite格式）

### Q: 如何清空数据库重新测试？

A: 删除数据库文件即可：
```bash
rm data/database.db
```

### Q: 为什么有些指标显示"数据缺失"？

A: 测试数据可能不完整。使用真实数据源（AkShare）可获取完整数据。

### Q: 如何添加更多测试股票？

A: 有两种方式：
1. 使用Phase 1的财报解析功能导入真实数据
2. 在Mock数据源中添加模拟股票数据

### Q: 警告信息是否正常？

A: 部分WARNING是正常的，表示某些可选字段缺失。只要命令能正常完成并显示结果即可。

## 📝 测试报告模板

测试完成后，可以填写以下报告：

```
测试日期：________
测试人：________

【基础功能测试】
✓ CLI工具安装：成功 / 失败
✓ 框架列表显示：成功 / 失败
✓ 股票信息查询：成功 / 失败
✓ 筛选功能：成功 / 失败
✓ 评分功能：成功 / 失败

【高级功能测试】
✓ 批量操作：成功 / 失败
✓ 框架切换：成功 / 失败
✓ 详细/简化模式：成功 / 失败

【问题记录】
1.
2.
3.

【建议】
1.
2.
```

## 🎓 下一步

测试通过后，您可以：

1. **导入真实数据**：使用Phase 1的财报解析功能
2. **自定义框架**：编辑`config/frameworks/`中的YAML文件
3. **扩展数据源**：实现新的数据源插件
4. **批量筛选**：编写脚本对整个股票池进行筛选

详细使用说明请参阅：`CLI_USAGE.md`
