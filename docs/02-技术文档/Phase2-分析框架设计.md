# Phase 2 - 分析框架设计

> 文档版本：v1.0（早期设计版本）
> 创建日期：2024-11-21
> 状态：✅ 已完成 (2025-11-22)
>
> ⚠️ **状态更新**：Phase 2 已完成实现
>
> **实际完成文档**: [Phase2实现总结.md](../../Phase2实现总结.md)
>
> 本文档为早期设计版本，保留用于参考原始设计。实际实现请参考上述完成总结文档。

## 📋 概述

Phase 2 实现智能分析功能，基于Phase 1提取的46个财务指标，提供两种经典投资框架的分析：
- **价值投资框架**（巴菲特风格）：关注稳健性、盈利能力、护城河
- **成长投资框架**（彼得·林奇风格）：关注增长性、扩张能力、行业前景

---

## 🎯 框架设计理念

### 核心思想
1. **规则透明**：所有评分规则公开透明，用户可以理解为什么得到这个评分
2. **可配置**：使用YAML配置文件，用户可以调整权重和阈值
3. **可扩展**：框架引擎设计通用，可以轻松添加新的分析框架

### 评分体系
- **总分：0-100分**
- **等级划分**：
  - A+（90-100分）：强烈推荐
  - A （80-89分）：推荐
  - B （70-79分）：值得关注
  - C （60-69分）：谨慎
  - D （50-59分）：不推荐
  - F （0-49分）：避免

---

## 📊 价值投资框架（Value Investing Framework）

### 设计理念
巴菲特的投资哲学核心：**寻找被低估的优质企业，长期持有**

关键要素：
1. **盈利能力**：公司能否持续赚钱？
2. **财务稳健**：资产负债健康吗？
3. **护城河**：竞争优势明显吗？
4. **估值**：价格合理吗？

### 评分规则

#### 1. 盈利能力（40分）

| 指标 | 权重 | 评分标准 |
|------|------|----------|
| **ROE（净资产收益率）** | 15分 | ≥20%：15分<br>15-20%：12分<br>10-15%：8分<br>5-10%：5分<br><5%：0分 |
| **毛利率** | 10分 | ≥40%：10分<br>30-40%：8分<br>20-30%：5分<br>10-20%：3分<br><10%：0分 |
| **净利率** | 10分 | ≥20%：10分<br>15-20%：8分<br>10-15%：5分<br>5-10%：3分<br><5%：0分 |
| **营收增长率** | 5分 | ≥15%：5分<br>10-15%：4分<br>5-10%：3分<br>0-5%：2分<br><0%：0分 |

**说明**：
- ROE是巴菲特最看重的指标，反映公司用股东的钱赚钱的能力
- 毛利率高说明产品有定价权
- 净利率高说明成本控制好
- 稳健增长更重要，不追求高增长

#### 2. 财务稳健（30分）

| 指标 | 权重 | 评分标准 |
|------|------|----------|
| **资产负债率** | 15分 | <30%：15分<br>30-50%：12分<br>50-70%：8分<br>70-100%：4分<br>>100%：0分 |
| **流动比率** | 8分 | ≥2：8分<br>1.5-2：6分<br>1-1.5：4分<br>0.5-1：2分<br><0.5：0分 |
| **经营现金流/净利润** | 7分 | ≥1.2：7分<br>1.0-1.2：5分<br>0.8-1.0：3分<br>0.5-0.8：1分<br><0.5：0分 |

**说明**：
- 低负债是安全垫
- 流动比率>1说明短期偿债能力强
- 现金流是真金白银，比利润更可靠

#### 3. 护城河（20分）

| 指标 | 权重 | 评分标准 |
|------|------|----------|
| **ROE连续性** | 8分 | 连续3年>15%：8分<br>连续2年>15%：6分<br>连续1年>15%：4分<br>其他：0分 |
| **毛利率稳定性** | 7分 | 近3年波动<5%：7分<br>波动5-10%：5分<br>波动10-20%：3分<br>波动>20%：0分 |
| **市场份额** | 5分 | 行业龙头：5分<br>行业前三：3分<br>其他：0分<br>（需人工标注或API） |

**说明**：
- 指标的稳定性比单一年份的高数值更重要
- 护城河体现在持续的高盈利能力

#### 4. 估值（10分）

| 指标 | 权重 | 评分标准 |
|------|------|----------|
| **PE（市盈率）** | 5分 | <10：5分<br>10-15：4分<br>15-25：3分<br>25-40：1分<br>>40：0分 |
| **PB（市净率）** | 5分 | <1：5分<br>1-2：4分<br>2-3：3分<br>3-5：1分<br>>5：0分 |

**说明**：
- PE和PB结合看，寻找低估的优质公司
- 不同行业标准不同，这里用通用标准

### 投资建议生成

| 总分 | 建议 | 条件 |
|------|------|------|
| 90-100 | **强烈买入** | 盈利能力优秀 + 财务稳健 + 估值合理 |
| 80-89 | **买入** | 3个维度得分均衡 |
| 70-79 | **持有/观察** | 有1-2个维度表现突出 |
| 60-69 | **谨慎** | 有明显短板 |
| <60 | **不推荐** | 多个维度不达标 |

---

## 🚀 成长投资框架（Growth Investing Framework）

### 设计理念
彼得·林奇的投资哲学：**寻找高成长的公司，在成长期持有**

关键要素：
1. **成长性**：增长速度快吗？
2. **扩张能力**：能持续扩张吗？
3. **行业趋势**：行业在增长吗？
4. **估值合理性**：PEG合理吗？

### 评分规则

#### 1. 成长性（40分）

| 指标 | 权重 | 评分标准 |
|------|------|----------|
| **营收增长率** | 15分 | ≥30%：15分<br>20-30%：12分<br>15-20%：9分<br>10-15%：6分<br><10%：0分 |
| **利润增长率** | 15分 | ≥30%：15分<br>20-30%：12分<br>15-20%：9分<br>10-15%：6分<br><10%：0分 |
| **增长加速度** | 10分 | 逐季加速：10分<br>稳定增长：7分<br>增速放缓：3分<br>负增长：0分 |

**说明**：
- 成长股最重要的是增速
- 营收和利润同时增长最好
- 增长加速度反映动能

#### 2. 扩张能力（30分）

| 指标 | 权重 | 评分标准 |
|------|------|----------|
| **资产周转率** | 10分 | >2：10分<br>1.5-2：8分<br>1-1.5：5分<br>0.5-1：3分<br><0.5：0分 |
| **ROE** | 10分 | >20%：10分<br>15-20%：8分<br>10-15%：5分<br>5-10%：3分<br><5%：0分 |
| **资本开支增长** | 10分 | 10-30%：10分<br>5-10%：7分<br>0-5%：4分<br><0%：0分<br>>30%：5分（过度扩张） |

**说明**：
- 高周转率说明资产使用效率高
- ROE高说明赚钱能力强，能支撑扩张
- 合理的资本开支增长说明在投资未来

#### 3. 盈利质量（20分）

| 指标 | 权重 | 评分标准 |
|------|------|----------|
| **毛利率** | 10分 | ≥30%：10分<br>20-30%：7分<br>10-20%：4分<br><10%：0分 |
| **经营现金流/净利润** | 10分 | ≥0.8：10分<br>0.6-0.8：7分<br>0.4-0.6：4分<br><0.4：0分 |

**说明**：
- 成长公司也要有盈利能力
- 现金流跟得上说明增长健康

#### 4. 估值合理性（10分）

| 指标 | 权重 | 评分标准 |
|------|------|----------|
| **PEG（市盈率/增长率）** | 10分 | <0.5：10分<br>0.5-1：8分<br>1-1.5：5分<br>1.5-2：3分<br>>2：0分 |

**说明**：
- PEG是彼得·林奇最喜欢的指标
- PEG<1说明估值合理或低估

### 投资建议生成

| 总分 | 建议 | 条件 |
|------|------|------|
| 90-100 | **强烈买入** | 高增长 + 高盈利质量 + 估值合理 |
| 80-89 | **买入** | 增长强劲，盈利质量良好 |
| 70-79 | **持有/观察** | 增长良好但估值偏高，或增速放缓 |
| 60-69 | **谨慎** | 增长放缓或盈利质量下降 |
| <60 | **不推荐** | 增长停滞或负增长 |

---

## 🔧 技术实现

### 框架配置文件结构

```yaml
# config/frameworks/value_investing.yaml
name: "价值投资框架"
description: "巴菲特风格，关注稳健性和护城河"
version: "1.0"

categories:
  - name: "盈利能力"
    weight: 40
    metrics:
      - name: "ROE"
        weight: 15
        rules:
          - condition: "value >= 0.20"
            score: 15
          - condition: "value >= 0.15"
            score: 12
          - condition: "value >= 0.10"
            score: 8
          - condition: "value >= 0.05"
            score: 5
          - default: 0

  # ... 其他指标
```

### 框架引擎类设计

```python
class FrameworkEngine:
    """分析框架引擎"""

    def __init__(self, config_path: str):
        """加载框架配置"""
        self.config = self._load_config(config_path)

    def analyze(self, metrics: dict) -> AnalysisResult:
        """
        分析财务指标，返回评分和建议

        Args:
            metrics: 从数据库提取的指标字典

        Returns:
            AnalysisResult包含：
            - total_score: 总分
            - category_scores: 各维度得分
            - recommendation: 投资建议
            - reason: 理由
            - risks: 风险提示
        """
        pass
```

---

## 📈 Phase 2.1 实施计划（本次迭代）

### 任务清单

- [ ] 创建框架配置文件
  - [ ] value_investing.yaml
  - [ ] growth_investing.yaml
- [ ] 实现框架引擎
  - [ ] FrameworkEngine类
  - [ ] 规则解析器
  - [ ] 评分计算器
- [ ] 实现建议生成器
  - [ ] RecommendationGenerator类
  - [ ] 建议逻辑
  - [ ] 理由生成
- [ ] 创建CLI工具
  - [ ] analyze命令
  - [ ] watchlist命令
- [ ] 实现报告生成
  - [ ] Markdown报告模板
  - [ ] 报告生成器
- [ ] 测试
  - [ ] 单元测试
  - [ ] 集成测试
  - [ ] 真实数据验证

### 验收标准

- ✅ 两个框架都能正常运行
- ✅ 评分逻辑正确
- ✅ 投资建议合理
- ✅ CLI工具易用
- ✅ 报告格式美观

---

## 🎯 后续迭代计划

### Phase 2.2：AI增强（可选）
- Claude API集成
- 文本分析（管理层讨论）
- 风险识别

### Phase 2.3：高级功能
- 历史趋势分析
- 同行对比
- 行业分析

---

## 📝 注意事项

### 设计原则
1. **保守评分**：宁可低估，不要高估
2. **透明可解释**：用户能理解每个得分的来源
3. **数据驱动**：基于客观指标，减少主观判断

### 免责声明
- 本框架仅供学习参考，不构成投资建议
- 过往表现不代表未来收益
- 投资有风险，决策需谨慎

---

**最后更新：** 2024-11-21
**状态：** 设计完成，待实施 ⏳
