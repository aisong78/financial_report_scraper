# 需求分析

> 文档版本：v1.0
> 创建日期：2024-11-21

## 用户画像

### 主要用户：Sonia（产品创建者）
- **背景**：个人投资者
- **投资经验**：散户级别
- **技术能力**：有 Python 基础
- **投资偏好**：价值投资 + 成长投资
- **痛点**：
  - 财报内容复杂难懂
  - 缺乏系统化的分析框架
  - 需要花大量时间手动收集和分析数据
  - 难以持续跟踪多只股票

### 未来目标用户：投资小白
- **特征**：缺乏财务知识，需要简单易懂的分析
- **需求**：一键获得投资建议，无需深入理解财务指标

---

## 功能需求

### P0 - 核心功能（MVP 必须）

#### 1. 财报自动获取
**需求描述**：
- 支持 A股、港股、美股三大市场
- 财报季自动下载最新财报
- 支持手动触发下载

**验收标准**：
- ✅ 能够正确识别股票代码类型
- ✅ 成功下载 PDF/HTML 格式财报
- ✅ 去重：不重复下载已有财报
- ✅ 错误处理：网络失败时自动重试

#### 2. 关键指标提取
**需求描述**：
- 从财报中提取核心财务指标
- 计算衍生指标（增长率、比率等）

**核心指标清单**（MVP 阶段）：
1. **盈利能力**
   - 营业收入
   - 净利润
   - 毛利率
   - 净利率
   - ROE（净资产收益率）
   - ROA（总资产收益率）

2. **成长性**
   - 营收同比增长率（YoY）
   - 净利润同比增长率
   - 营收环比增长率（QoQ）

3. **财务健康**
   - 资产负债率
   - 流动比率
   - 速动比率
   - 经营性现金流

4. **估值指标**
   - PE（市盈率）
   - PB（市净率）
   - PS（市销率）

**验收标准**：
- ✅ 所有指标提取准确率 100%
- ✅ 能够处理 A股、港股、美股不同格式

#### 3. 预设分析框架
**需求描述**：
- 实现价值投资分析框架
- 实现成长投资分析框架
- 每个框架输出多维度评分

**价值投资框架规则**：
```yaml
盈利能力评分 (40%)
  - ROE > 15%: 优秀 (100分)
  - ROE 10-15%: 良好 (70分)
  - ROE < 10%: 一般 (40分)

财务健康评分 (30%)
  - 负债率 < 40%: 优秀 (100分)
  - 负债率 40-60%: 良好 (70分)
  - 负债率 > 60%: 警示 (40分)

成长性评分 (20%)
  - 营收增长 > 15%: 优秀 (100分)
  - 营收增长 5-15%: 良好 (70分)
  - 营收增长 < 5%: 一般 (40分)

估值评分 (10%)
  - PE < 行业平均*0.8: 低估 (100分)
  - PE 介于之间: 合理 (70分)
  - PE > 行业平均*1.2: 高估 (40分)
```

**成长投资框架规则**：
```yaml
高成长评分 (50%)
  - 营收增长 > 30%: 优秀 (100分)
  - 净利润增长 > 30%: 优秀 (100分)

盈利质量评分 (30%)
  - 毛利率稳定上升: 优秀
  - 经营性现金流 > 净利润: 优秀

市场地位评分 (20%)
  - 研发投入占比
  - 市场份额增长
```

**验收标准**：
- ✅ 能够根据框架自动打分
- ✅ 输出清晰的评分理由

#### 4. 简单报告生成
**需求描述**：
- 生成 Markdown 格式分析报告
- 包含关键指标、评分、投资建议

**报告模板**：
```markdown
# {股票名称} ({股票代码}) 财报分析

## 📊 财报信息
- 报告期：2024Q3
- 发布日期：2024-10-30
- 报告类型：季度报告

## 💰 核心指标

| 指标 | 数值 | 同比变化 | 环比变化 |
|------|------|----------|----------|
| 营业收入 | 123.45亿 | +15.2% | +5.3% |
| 净利润 | 45.67亿 | +18.5% | +6.2% |
| ROE | 25.3% | +2.1pp | +0.5pp |
| 负债率 | 18.2% | -1.5pp | -0.3pp |

## 🎯 分析框架评分

### 价值投资框架
- **盈利能力**: ⭐⭐⭐⭐⭐ (95/100)
  - ROE 25.3%，远超 15% 优秀线
  - 净利率 37%，行业领先

- **财务健康**: ⭐⭐⭐⭐⭐ (98/100)
  - 负债率 18.2%，极低
  - 现金流充沛

- **成长性**: ⭐⭐⭐⭐ (82/100)
  - 营收增长 15.2%，稳健
  - 利润增长 18.5%，超预期

- **估值**: ⭐⭐⭐⭐ (75/100)
  - PE 35x，略高于行业均值 32x

**综合评级**: A+ (强烈推荐)

## 💡 投资建议

✅ **买入信号**
1. 盈利质量优秀，ROE 持续高位
2. 财务极其健康，无债务风险
3. 增长稳定，超市场预期 3%

⚠️ **风险提示**
1. 估值略高，注意回调风险
2. 行业政策不确定性

## 📈 历史趋势
（Phase 2 功能）

## 🔍 AI 深度分析
（Phase 2 功能）
```

**验收标准**：
- ✅ 报告内容完整
- ✅ 格式清晰易读
- ✅ 数据准确无误

#### 5. 自选股管理
**需求描述**：
- 维护一个自选股列表
- 支持添加/删除操作
- 批量分析自选股

**命令示例**：
```bash
# 添加自选股
python -m src.cli.main watchlist add 600519 00700 AAPL

# 查看自选股
python -m src.cli.main watchlist list

# 删除自选股
python -m src.cli.main watchlist remove 600519

# 分析所有自选股
python -m src.cli.main analyze --watchlist
```

**验收标准**：
- ✅ 增删改查功能正常
- ✅ 数据持久化存储

---

### P1 - 重要功能（Phase 2）

#### 6. AI 文本分析
**需求描述**：
- 使用 LLM 分析管理层讨论与分析（MD&A）
- 识别风险因素
- 总结业务亮点

**混合分析策略**：
1. **结构化数据**：完全使用确定性算法（不用 AI）
2. **文本分析**：使用 LLM
3. **校验层**：AI 结论与数据交叉验证

**Prompt 示例**：
```
你是一位专业的财报分析师。请阅读以下"管理层讨论与分析"部分，提取以下信息：

1. 业务亮点（3-5条）
2. 主要风险（3-5条）
3. 未来展望（2-3条）

要求：
- 只提取文本中明确提到的内容
- 不要推测或编造信息
- 使用简洁的语言

文本内容：
{MD&A 文本}
```

**验收标准**：
- ✅ AI 输出与原文一致
- ✅ 有明确的置信度标识

#### 7. 预期对比
**需求描述**：
- 收集市场预期数据（分析师预测）
- 对比实际业绩 vs 预期
- 计算超预期/低预期幅度

**数据来源**（待调研）：
- 同花顺
- 东方财富
- 雪球

**验收标准**：
- ✅ 成功获取主流股票的市场预期
- ✅ 准确计算超预期幅度

#### 8. 历史趋势分析
**需求描述**：
- 查询最近 8 个季度数据
- 生成趋势图
- 识别趋势（上升/下降/波动）

**验收标准**：
- ✅ 趋势图清晰
- ✅ 趋势判断合理

#### 9. 自定义分析框架
**需求描述**：
- 用户可以通过 YAML 配置自己的分析框架
- 系统自动执行自定义规则

**配置示例**：
```yaml
name: "我的价值框架"
version: "1.0"

metrics:
  - name: "盈利能力"
    weight: 0.4
    rules:
      - indicator: ROE
        thresholds:
          - {min: 20, score: 100, label: "优秀"}
          - {min: 15, max: 20, score: 80, label: "良好"}
          - {max: 15, score: 50, label: "一般"}

  - name: "成长性"
    weight: 0.3
    rules:
      - indicator: revenue_growth_yoy
        thresholds:
          - {min: 25, score: 100}
          - {min: 15, max: 25, score: 70}
          - {max: 15, score: 40}
```

**验收标准**：
- ✅ 配置文件解析正确
- ✅ 规则执行准确

---

### P2 - 进阶功能（Phase 3）

#### 10. 财报季自动监控
**需求描述**：
- 维护财报发布日历
- 财报前：收集预期
- 财报时：自动下载分析
- 财报后：持续跟踪

**财报季时间线**：
```
T-7天: 预期收集开始
T-3天: 预期汇总
T日:   财报发布，立即下载分析
T+1日: 市场反应分析
T+7日: 持续跟踪
```

**验收标准**：
- ✅ 日历数据准确
- ✅ 自动化流程正常

#### 11. 同行业对比
**需求描述**：
- 识别股票所属行业
- 拉取同行业其他公司数据
- 生成对比报告

**验收标准**：
- ✅ 行业分类准确
- ✅ 对比维度全面

#### 12. 邮件通知
**需求描述**：
- 分析完成后发送邮件
- 重要信号（买入/卖出）告警

**验收标准**：
- ✅ 邮件发送成功
- ✅ 内容格式良好

---

### P3 - 产品化功能（Phase 4）

#### 13. Web 界面
**需求描述**：
- 可视化仪表盘
- 在线查询和分析
- 报告在线查看

#### 14. 多用户支持
**需求描述**：
- 用户注册登录
- 数据隔离
- 自选股独立管理

---

## 非功能需求

### 性能要求
- 单只股票分析耗时 < 30秒
- 支持同时分析 20+ 只股票
- 数据库查询响应 < 1秒

### 可靠性要求
- 关键指标准确率 100%
- 网络失败自动重试
- 异常情况日志记录

### 可维护性
- 代码模块化，易于扩展
- 完整的单元测试
- 清晰的文档

### 安全性
- 敏感信息加密存储
- API 调用频率限制
- 输入验证防注入

---

## 使用场景

### 场景 1：查询单只股票
```
用户：我想看看贵州茅台最新财报怎么样

操作：
1. python -m src.cli.main analyze --stock 600519
2. 系统自动下载最新财报
3. 提取指标、分析、生成报告
4. 输出 Markdown 报告

结果：
用户获得完整分析报告，包括评分和投资建议
```

### 场景 2：财报季批量分析
```
用户：财报季到了，我想看看我的自选股表现

操作：
1. 预先添加自选股：600519, 00700, AAPL, TSLA
2. python -m src.cli.main analyze --watchlist
3. 系统逐个分析，生成汇总报告

结果：
用户快速了解所有持仓的最新情况
```

### 场景 3：自定义分析框架
```
用户：我想用自己的选股标准

操作：
1. 编写 YAML 配置文件
2. python -m src.cli.main analyze --stock 600519 --framework my_custom
3. 系统使用自定义规则分析

结果：
用户获得符合自己投资理念的分析
```

---

## 约束条件

### 技术约束
- 必须使用 Python（用户熟悉）
- 优先使用开源免费工具
- LLM API 调用需控制成本

### 业务约束
- MVP 阶段：仅个人使用
- 数据源受限于公开渠道
- 财报下载受限于网站反爬

### 时间约束
- MVP 目标：2-3 周
- 完整产品：2-3 月

---

## 成功指标

### MVP 阶段
- ✅ 成功分析 10+ 只股票
- ✅ 报告内容准确完整
- ✅ 用户（Sonia）认可实用性

### Phase 2
- ✅ 自定义框架功能可用
- ✅ AI 分析准确率 > 85%

### Phase 3
- ✅ 财报季自动化流程稳定运行

### Phase 4
- ✅ 有外部用户开始使用
- ✅ 用户反馈积极

---

## 下一步

详见 [分阶段实施计划](./分阶段实施计划.md)
