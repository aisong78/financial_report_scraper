# å¤šæ•°æ®æºä½¿ç”¨æŒ‡å—

## ğŸ“š æ¦‚è¿°

è´¢æŠ¥åˆ†æç³»ç»Ÿç°åœ¨æ”¯æŒ**å¤šç§æ•°æ®æº**ï¼Œå¯ä»¥è‡ªåŠ¨åˆ‡æ¢ï¼Œç¡®ä¿åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½èƒ½è·å–åˆ°è´¢æŠ¥æ•°æ®ã€‚

---

## ğŸ¯ æ”¯æŒçš„æ•°æ®æº

| æ•°æ®æº | ç±»å‹ | è´¹ç”¨ | æ•°æ®æ ¼å¼ | æ¨èåº¦ |
|--------|------|------|----------|--------|
| **å·¨æ½®èµ„è®¯** | çˆ¬è™« | å…è´¹ | PDF | â­â­â­â­ |
| **AkShare** | Pythonåº“ | å…è´¹ | DataFrame | â­â­â­â­â­ |
| **Tushare Pro** | API | éœ€ç§¯åˆ† | DataFrame | â­â­â­ |
| **è‡ªå®šä¹‰** | è‡ªå·±å®ç° | - | çµæ´» | - |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼1ï¼šä½¿ç”¨é»˜è®¤æ•°æ®æºï¼ˆå·¨æ½®èµ„è®¯ï¼‰

**ä¸éœ€è¦ä»»ä½•é…ç½®ï¼**

```python
from src.scrapers.data_source_manager import get_financial_data

# è·å–è´¢æŠ¥æ•°æ®
data = get_financial_data('600519', lookback_days=365)

if data:
    print(f"æ•°æ®æ¥æº: {data['source']}")
    print(f"æ–‡ä»¶è·¯å¾„: {data['file_path']}")
```

---

### æ–¹å¼2ï¼šå¯ç”¨ AkShareï¼ˆæ¨èï¼‰

**ä¼˜ç‚¹**: æ›´ç¨³å®šã€æ›´å¿«ã€æ•°æ®æ›´å‡†ç¡®

**æ­¥éª¤**:

1. å®‰è£… AkShare
```bash
pip install akshare
```

2. ä¿®æ”¹ `config.json`
```json
{
    "preferred_source": "akshare",
    "enable_akshare": true
}
```

3. ä½¿ç”¨
```python
from src.scrapers.data_source_manager import DataSourceManager

config = {
    'preferred_source': 'akshare',
    'enable_akshare': True
}

manager = DataSourceManager(config)
data = manager.fetch_data('600519')

if data:
    # AkShare è¿”å›çš„æ˜¯ DataFrame
    balance_df = data['balance_sheet']      # èµ„äº§è´Ÿå€ºè¡¨
    income_df = data['income_statement']    # åˆ©æ¶¦è¡¨
    cashflow_df = data['cash_flow']         # ç°é‡‘æµé‡è¡¨

    print(balance_df.head())
```

---

### æ–¹å¼3ï¼šå¯ç”¨ Tushare Pro

**æ­¥éª¤**:

1. æ³¨å†Œå¹¶è·å– token: https://tushare.pro/register

2. å®‰è£… Tushare
```bash
pip install tushare
```

3. ä¿®æ”¹ `config.json`
```json
{
    "preferred_source": "tushare",
    "enable_tushare": true,
    "tushare_token": "ä½ çš„token"
}
```

4. ä½¿ç”¨
```python
from src.scrapers.data_source_manager import get_financial_data

config = {
    'preferred_source': 'tushare',
    'enable_tushare': True,
    'tushare_token': 'ä½ çš„token'
}

data = get_financial_data('600519', config=config, period='20231231')
```

---

## ğŸ”„ è‡ªåŠ¨åˆ‡æ¢æœºåˆ¶

æ•°æ®æºç®¡ç†å™¨ä¼š**è‡ªåŠ¨å°è¯•æ‰€æœ‰å¯ç”¨æ•°æ®æº**ï¼Œç›´åˆ°æˆåŠŸï¼š

```python
from src.scrapers.data_source_manager import DataSourceManager

config = {
    'preferred_source': 'akshare',  # é¦–é€‰ AkShare
    'enable_akshare': True,
    'enable_tushare': True,
    'tushare_token': 'ä½ çš„token'
}

manager = DataSourceManager(config)

# è‡ªåŠ¨åˆ‡æ¢ï¼šAkShare â†’ å·¨æ½®èµ„è®¯ â†’ Tushare
data = manager.fetch_data('600519')
```

**åˆ‡æ¢é€»è¾‘**:
1. å…ˆå°è¯•é¦–é€‰æ•°æ®æºï¼ˆAkShareï¼‰
2. å¤±è´¥åˆ™å°è¯•å·¨æ½®èµ„è®¯
3. ä»å¤±è´¥åˆ™å°è¯• Tushare
4. æ‰€æœ‰å¤±è´¥åˆ™è¿”å› None

---

## ğŸ“ é…ç½®é€‰é¡¹

åœ¨ `config.json` ä¸­æ·»åŠ ï¼š

```json
{
    // åŸºæœ¬é…ç½®ï¼ˆå·²æœ‰ï¼‰
    "user_email": "your@email.com",
    "save_dir": "reports",
    "lookback_days": 365,

    // æ•°æ®æºé…ç½®ï¼ˆæ–°å¢ï¼‰
    "preferred_source": "cninfo",    // é¦–é€‰æ•°æ®æº: cninfo|akshare|tushare
    "enable_akshare": false,          // æ˜¯å¦å¯ç”¨ AkShare
    "enable_tushare": false,          // æ˜¯å¦å¯ç”¨ Tushare
    "tushare_token": ""               // Tushare token
}
```

---

## ğŸ’¡ ä½¿ç”¨å»ºè®®

### æ¨èç»„åˆ1ï¼šç¨³å®šä¼˜å…ˆ
```json
{
    "preferred_source": "akshare",
    "enable_akshare": true
}
```
- AkShare ä¸ºä¸»ï¼ˆç¨³å®šã€å¿«é€Ÿï¼‰
- å·¨æ½®èµ„è®¯ä¸ºå¤‡ä»½ï¼ˆå®˜æ–¹æƒå¨ï¼‰

### æ¨èç»„åˆ2ï¼šå®˜æ–¹ä¼˜å…ˆ
```json
{
    "preferred_source": "cninfo",
    "enable_akshare": true
}
```
- å·¨æ½®èµ„è®¯ä¸ºä¸»ï¼ˆå®˜æ–¹ã€æƒå¨ï¼‰
- AkShare ä¸ºå¤‡ä»½ï¼ˆåº”å¯¹åçˆ¬è™«ï¼‰

### æ¨èç»„åˆ3ï¼šå…¨èƒ½å‹
```json
{
    "preferred_source": "akshare",
    "enable_akshare": true,
    "enable_tushare": true,
    "tushare_token": "ä½ çš„token"
}
```
- ä¸‰ä¸ªæ•°æ®æºéƒ½å¯ç”¨
- æœ€å¤§ç¨‹åº¦ä¿è¯æˆåŠŸç‡

---

## ğŸ”§ é«˜çº§ç”¨æ³•

### 1. æ·»åŠ è‡ªå®šä¹‰æ•°æ®æº

```python
from src.scrapers.data_source_manager import DataSource, DataSourceType, DataSourceManager

class MyCustomDataSource(DataSource):
    def __init__(self):
        super().__init__(DataSourceType.CUSTOM, "æˆ‘çš„æ•°æ®æº")

    def _check_availability(self) -> bool:
        # æ£€æŸ¥æ•°æ®æºæ˜¯å¦å¯ç”¨
        return True

    def fetch_financial_data(self, stock_code: str, **kwargs):
        # å®ç°è·å–æ•°æ®çš„é€»è¾‘
        # è¿”å›æ ¼å¼:
        return {
            'source': self.name,
            'data': ...
        }

# ä½¿ç”¨è‡ªå®šä¹‰æ•°æ®æº
manager = DataSourceManager()
manager.add_custom_source(MyCustomDataSource())
data = manager.fetch_data('600519')
```

### 2. æŸ¥çœ‹å¯ç”¨æ•°æ®æº

```python
from src.scrapers.data_source_manager import DataSourceManager

manager = DataSourceManager()

print(f"å¯ç”¨æ•°æ®æº: {len(manager.available_sources)}")
for source in manager.available_sources:
    print(f"  - {source.name} ({source.source_type.value})")
```

### 3. æŒ‡å®šå•ä¸ªæ•°æ®æº

```python
from src.scrapers.data_source_manager import DataSourceManager

# åªä½¿ç”¨å·¨æ½®èµ„è®¯
config = {'preferred_source': 'cninfo'}
manager = DataSourceManager(config)

# æˆ–è€…åªä½¿ç”¨ AkShare
config = {
    'preferred_source': 'akshare',
    'enable_akshare': True
}
manager = DataSourceManager(config)
```

---

## â“ å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆæ¨è AkShareï¼Ÿ

**A**: AkShare çš„ä¼˜åŠ¿ï¼š
- âœ… ä¸éœ€è¦ä¸‹è½½PDFï¼ˆè·³è¿‡æœ€å®¹æ˜“å‡ºé”™çš„ç¯èŠ‚ï¼‰
- âœ… ç›´æ¥è¿”å›ç»“æ„åŒ–æ•°æ®ï¼ˆæ›´å‡†ç¡®ï¼‰
- âœ… ä¸ç”¨æ‹…å¿ƒåçˆ¬è™«
- âœ… å…è´¹å¼€æº
- âœ… ç»´æŠ¤æ´»è·ƒ

**æ•°æ®æµç¨‹å¯¹æ¯”**:
```
å·¨æ½®èµ„è®¯: ä¸‹è½½PDF â†’ è§£æPDF â†’ æå–æ•°æ® â†’ åˆ†æ
         (æ…¢ã€å¯èƒ½å¤±è´¥ã€ç²¾åº¦å–å†³äºè§£æ)

AkShare:  è·å–æ•°æ® â†’ åˆ†æ
         (å¿«ã€ç¨³å®šã€æ•°æ®å‡†ç¡®)
```

### Q2: AkShare å®‰è£…å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**A**: AkShare æœ‰å¾ˆå¤šä¾èµ–ï¼Œå¦‚æœå®‰è£…å¤±è´¥ï¼š

**æ–¹æ¡ˆ1**: å•ç‹¬å®‰è£…å¤±è´¥çš„åŒ…
```bash
pip install pandas requests beautifulsoup4 lxml
pip install akshare
```

**æ–¹æ¡ˆ2**: ä½¿ç”¨å·¨æ½®èµ„è®¯ï¼ˆé»˜è®¤æ•°æ®æºï¼‰
```python
# ä¸ç”¨é…ç½®ï¼Œç›´æ¥ä½¿ç”¨
from src.scrapers import scrape_a_stock
files = scrape_a_stock('600519')
```

**æ–¹æ¡ˆ3**: ä½¿ç”¨ Tushareï¼ˆéœ€è¦æ³¨å†Œï¼‰

### Q3: æ•°æ®æºéƒ½å¤±è´¥äº†æ€ä¹ˆåŠï¼Ÿ

**A**: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. **ç½‘ç»œè¿æ¥** - ç¡®ä¿èƒ½è®¿é—®å¤–ç½‘
2. **ä¾èµ–å®‰è£…** - è¿è¡Œ `pip install -r requirements.txt`
3. **é…ç½®æ­£ç¡®** - æ£€æŸ¥ config.json
4. **IPé™åˆ¶** - å¦‚æœè¢«å°ç¦ï¼Œç­‰å¾…æˆ–æ¢IP

æŸ¥çœ‹æ—¥å¿—ï¼š
```bash
cat logs/financial_scraper.log
```

### Q4: ä¸åŒæ•°æ®æºçš„æ•°æ®æ ¼å¼ä¸ä¸€æ ·æ€ä¹ˆåŠï¼Ÿ

**A**: ç¨‹åºä¼šè‡ªåŠ¨å¤„ç†ï¼

```python
data = manager.fetch_data('600519')

# æ£€æŸ¥æ•°æ®ç±»å‹
if data['data_type'] == 'pdf':
    # å·¨æ½®èµ„è®¯è¿”å›çš„ï¼Œéœ€è¦è§£æ
    file_path = data['file_path']
    # ä½¿ç”¨ PDFParser è§£æ

elif data['data_type'] == 'dataframe':
    # AkShare/Tushare è¿”å›çš„ï¼Œç›´æ¥ä½¿ç”¨
    balance_df = data['balance_sheet']
```

### Q5: å¦‚ä½•åˆ‡æ¢é¦–é€‰æ•°æ®æºï¼Ÿ

**A**: ä¿®æ”¹ `config.json`:
```json
{
    "preferred_source": "akshare"  // æ”¹æˆä½ æƒ³è¦çš„
}
```

æˆ–è€…åœ¨ä»£ç ä¸­ï¼š
```python
config = {'preferred_source': 'akshare'}
manager = DataSourceManager(config)
```

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æ•°æ®æº | é€Ÿåº¦ | æˆåŠŸç‡ | æ•°æ®å‡†ç¡®åº¦ | ä½¿ç”¨éš¾åº¦ |
|--------|------|--------|-----------|---------|
| **å·¨æ½®èµ„è®¯** | ä¸­ | 70% | é«˜ï¼ˆè§£æå¯èƒ½æœ‰è¯¯ï¼‰ | ç®€å• |
| **AkShare** | å¿« | 95% | å¾ˆé«˜ | ç®€å• |
| **Tushare** | å¿« | 95% | å¾ˆé«˜ | éœ€æ³¨å†Œ |

---

## ğŸ“ æœ€ä½³å®è·µ

1. **ç”Ÿäº§ç¯å¢ƒ**: ä½¿ç”¨ AkShare + å·¨æ½®èµ„è®¯ç»„åˆ
   ```json
   {
       "preferred_source": "akshare",
       "enable_akshare": true
   }
   ```

2. **æµ‹è¯•ç¯å¢ƒ**: ä½¿ç”¨å·¨æ½®èµ„è®¯ï¼ˆæ— éœ€é¢å¤–ä¾èµ–ï¼‰
   ```json
   {
       "preferred_source": "cninfo"
   }
   ```

3. **é«˜å¯ç”¨åœºæ™¯**: å¯ç”¨æ‰€æœ‰æ•°æ®æº
   ```json
   {
       "preferred_source": "akshare",
       "enable_akshare": true,
       "enable_tushare": true,
       "tushare_token": "your_token"
   }
   ```

---

## ğŸ“– ç›¸å…³æ–‡æ¡£

- [å¿«é€Ÿå¼€å§‹.md](å¿«é€Ÿå¼€å§‹.md) - æ–°æ‰‹å…¥é—¨æŒ‡å—
- [æ•°æ®æºå¤‡é€‰æ–¹æ¡ˆ.md](æ•°æ®æºå¤‡é€‰æ–¹æ¡ˆ.md) - æ•°æ®æºè¯¦ç»†å¯¹æ¯”
- [README.md](README.md) - é¡¹ç›®æ¦‚è§ˆ

---

**æœ€åæ›´æ–°**: 2024-11-21
**ç‰ˆæœ¬**: v1.1.0

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹æ—¥å¿—ï¼š`logs/financial_scraper.log`
